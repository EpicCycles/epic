{% extends 'epic/base.html' %}
{% load static %}

{% block content %}
    <div>
        <h2>Customer Details</h2>
        <form action="" method="post">
            {% csrf_token %}
            <table>
                <tr>
                    <td class="align_top">
                        <h3>Customer</h3>
                        {% with customer_form as form %}
                            {% include "epic/form_as_table.html" %}
                        {% endwith %}
                        <br/>
                    </td>
                    {% if customer %}
                        <td class="align_top">
                            <h3>New Quote</h3>
                            {% with customer_quote_form as form %}
                                {% include "epic/form_as_table.html" %}
                            {% endwith %}
                            <div {% if customer_quote_form.quote_type.value != "B" %}style="display: none"{% endif %} id="frame_detail">
                                <h4>Frame Details</h4>
                                {% with quote_frame_form as form %}
                                    {% include "epic/form_as_table.html" %}
                                {% endwith %}
                            </div>
                        </td>
                        <td class="align_top">
                            {% include "epic/add_notes.html" %}
                            <br/>
                            <input type="button"
                                   onclick="popupDetail('{% url 'view_customer_notes' pk=customer.pk %}','Customer Notes')"
                                   class="button" value="View Notes"
                            />
                        </td>
                    {% endif %}
                </tr>
            </table>
            {% include "epic/form_standard_actions.html" %}
            <fieldset>
                <h3>Customer Address</h3>
                {{ address_form_set.management_form }}
                {{ address_form_set.non_form_errors }}
                <table>
                    {% for form in address_form_set %}
                        {% include "epic/formset_display.html" %}
                    {% endfor %}
                </table>
                {% for form in address_form_set %}
                    {{ form.non_field_errors }}
                    {% for hidden in form.hidden_fields %}
                        {{ hidden }}
                    {% endfor %}
                {% endfor %}
            </fieldset>
            <table>
                <tr>
                    <td class="align_top">
                        <fieldset>
                            <h3>Customer Phone</h3>
                            {{ phone_form_set.management_form }}
                            {{ phone_form_set.non_form_errors }}
                            <table>
                                {% for form in phone_form_set %}
                                    {% include "epic/formset_display.html" %}
                                {% endfor %}
                            </table>
                            {% for phoneForm in phone_form_set %}
                                {{ phoneForm.non_field_errors }}
                                {% for hidden in phoneForm.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endfor %}
                        </fieldset>
                    </td>
                    <td class="align_top">
                        <fieldset>
                            <h3>Customer Fittings</h3>
                            {{ fitting_form_set.management_form }}
                            {{ fitting_form_set.non_form_errors }}
                            <table>
                                {% for form in fitting_form_set %}
                                    {% include "epic/formset_display.html" %}
                                {% endfor %}
                            </table>
                            {% for fitting_form in fitting_form_set %}
                                {{ fitting_form.non_field_errors }}
                                {% for hidden in fitting_form.hidden_fields %}
                                    {{ hidden }}
                                {% endfor %}
                            {% endfor %}
                        </fieldset>
                    </td>
                </tr>
            </table>
            {% include "epic/form_standard_actions.html" %}
            {% if existing_quotes %}
                <h3>Existing Quotes</h3>
                <table>
                    <tr>
                        <th class="listHead">Name</th>
                        <th class="listHead">Value</th>
                        <th class="listHead"></th>
                        <th class="listHead"></th>
                    </tr>
                    {% for quote in existing_quotes %}
                        <tr>
                            <td>{{ quote }}</td>
                            <td>{{ quote.keyed_sell_price }}</td>
                            <td>{% if quote.issuedDate == None %}
                                {% if quote.quote_type == 'B' %}
                                    <a href="{% url 'quote_edit_bike' pk=quote.pk %}" target="_blank"
                                       class="button">
                                {% else %}
                                    <a href="{% url 'quote_edit_simple' pk=quote.pk %}" target="_blank"
                                       class="button">
                                {% endif %}
                            edit</a>{% endif %}</td>
                            <td><a href="{% url 'copy_quote' pk=quote.pk %}" target="_blank"
                                   class="button">copy</a></td>
                        </tr>
                    {% endfor %}
                </table>
            {% endif %}
        </form>
     <script src="{% static 'js/maintain_customer.js' %}"></script>
   </div>

{% endblock %}
