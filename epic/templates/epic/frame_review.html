{% extends 'epic/base.html' %}
{% load staticfiles %}
{% load static %}

{% block content %}
    <form action="" method="post" name="reviewBikes" id="reviewBikes">
        {% csrf_token %}
        <input type="hidden" id="frame_name_selected" name="frame_name_selected" value="{{ frame_name_selected }}"/>
        <input type="hidden" id="frame_name_selected_init" name="frame_name_selected_init"
               value="{{ frame_name_selected }}"/>
        <input type="hidden" id="model_selected" name="model_selected" value="{{ model_selected }}"/>
        <input type="hidden" id="model_selected_init" name="model_selected_init" value="{{ model_selected }}"/>
        <input type="hidden" id="brand_selected_init" name="brand_selected_init" value="{{ frame_brand }}"/>
        <input type="hidden" id="action_required" name="action_required" value="start_review_default"/>
        <section style="width:100%">
            <div class="field-label">
                <label for="frame_brand" class="field-label">Brand</label>
                <select id="frame_brand" name="frame_brand" onchange="processSelectedBrand()">
                    <option></option>
                    {% for brand in brands %}
                        <option value="{{ brand.id }}">
                            {{ brand }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div style="display: none;" id="frameDiv" class="field-label">
                <label for="frame_name" class="field-label">Frame</label>
                <select id="frame_name" onchange="processSelectedFrame()">
                </select>
            </div>
            <div style="display: none;" id="modelDiv" class="field-label">
                <label for="model_name" class="field-label" onchange="processSelectedModel()">Model</label>
                <select id="model_name">
                </select>
            </div>
            <div>
                <input type="button"
                       id="reviewButton"
                       value="Review Selected"
                       onclick="setReviewAction('startReview')"
                       title="Review bikes selected"
                       class="button"/>
            </div>
        </section>
        {% if frame_sections %}
            <section class="flex-vertical">
                <section style="width:100%">
                    <div style="width: 50%">
                        <h3>Bike specification</h3>
                    </div>
                    <div class="align-right">
                        <input type="button"
                               id="saveButton"
                               value="Save Changes"
                               onclick="setReviewAction('save_changes')"
                               title="Save current settings"
                               class="button"/>
                        <input type="button"
                               id="nextButton"
                               value="Show Next"
                               onclick="setReviewAction('show_next')"
                               title="Show Next Bike"
                               class="button"/>
                        <input type="reset" value="Reset" class="button"/>
                    </div>
                </section>
                <section style="width:100%">
                    <div>
                        {% include "epic/form_as_table.html" with form=frame_form %}
                    </div>
                    <div>
                        <table>
                            <tr id="bike_header">
                                <th class="listHead">Part Type</th>
                                <th class="listHead">Brand</th>
                                <th class="listHead">Part</th>
                                <th class="listHead">Not Appicable</th>
                            </tr>
                        </table>
                        <div style="height: 60%; width:auto; overflow: scroll;">
                            <table>
                                {% for section, sectionContents in frame_sections %}
                                    <tr>
                                        <td colspan='4' class="section_part">{{ section.name }}</td>
                                    </tr>
                                    {% for part_type, form in sectionContents %}
                                        {% cycle 'row1' 'row2' as rowcolors silent %}
                                        <tr class="{{ rowcolors }}"
                                                {% if forloop.first %}
                                            id="bike_row"
                                                {% endif %}>
                                            <td>
                                                {{ part_type }}
                                                {{ form.non_field_errors }}
                                                {% for hidden in form.hidden_fields %}
                                                    {{ hidden }}
                                                {% endfor %}
                                            </td>
                                            {% for field in form.visible_fields %}
                                                {% include "epic/field_as_td.html"  with field=field %}
                                            {% endfor %}

                                        </tr>
                                    {% endfor %}
                                {% endfor %}
                            </table>
                        </div>
                    </div>
                </section>
            </section>
            <input type="hidden" id="frame_id" name="frame_id" value="{{ frame_id }}"/>
        {% endif %}


    </form>
    {% if frames_for_js %}

        <script type="text/javascript">
            //declare ops-variable in here and use it
            let frames = [];
            {% for frame in frames_for_js %}
                frames.push({{ frame |safe }});
            {% endfor %}

            // copy these bits into static below once tested.

        </script>

    {% endif %}
    <script src="{% static 'js/frame_review.js' %}"></script>

{% endblock %}
