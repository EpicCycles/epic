{% extends 'epic/base.html' %}

{% block content %}
    <form action="" method="post">
        {% csrf_token %}
        <table width="100%">
            <tr>
                <td><h2>Quote</h2></td>
                <td class="page_actions">
                    {% include "epic/form_standard_actions.html" %}
                    <a href="{% url 'quote_issue' pk=quote.pk %}"  {% if quote.can_be_issued %}
                       class="button" {% else %} class="button disabled" onclick="return false;" {% endif %}>Issue
                        Quote</a>
                </td>
            </tr>
        </table>
        <table>
            <tr>
                <td class="align_top">
                    <h3>{{ quote.customer }}</h3>
                    {{ quote_form.non_field_errors }}
                    <table>
                        {% for field in quote_form.visible_fields %}
                            <tr>
                                <th>{{ field.label_tag }}</th>
                                <td>{{ field }}</td>
                                <td>{{ field.errors }}</td>
                            </tr>
                        {% endfor %}
                        <tr>
                            <th>Calculated Total</th>
                            <td>{{ quote_form.sell_price.value }}</td>
                            <td></td>
                        </tr>
                    </table>
                    {% for hidden in quote_form.hidden_fields %}
                        {{ hidden }}
                    {% endfor %}
                </td>
                <td class="align_top">
                    <h3>Add Item</h3>
                    {% with quoteSimpleAddPart as form %}
                        {% include "epic/form_as_table.html" %}
                    {% endwith %}
                    <input type="button"
                           onclick="popupDetail('{% url 'add_brand' %}','Add New Brand')"
                           class="button" value="Add New Brand"
                    />
                </td>
                <td class="align_top">
                    {% include "epic/add_notes.html" %}
                </td>
            </tr>
        </table>

        <fieldset>
            <h3>Amend Items</h3>
            <table>
                <tr>
                    <th class="listHead">Part Type</th>
                    <th class="listHead">Part</th>
                    <th class="listHead">Additional Details</th>
                    <th class="listHead">Quantity</th>
                    <th class="listHead">Cost Price</th>
                    <th class="listHead">Sell Price</th>
                </tr>
                {% for quotePartDetails, form in zipped_values %}
                    {% cycle 'row1' 'row2' as rowcolors silent %}
                    <tr class="{{ rowcolors }}">
                        {% for quote_part_data in quotePartDetails %}
                            {% if forloop.counter == 1 %}
                                <td>{{ quote_part_data.partType }}</td>
                                <td>{{ quote_part_data.part }}</td>
                            {% endif %}
                            {% if forloop.counter == 2 %}
                                <td class="noPadding">
                                    <table>
                                        {% for quotePartAttributeForm in quote_part_data %}
                                            <tr class="{{ rowcolors }}">
                                                <td>{{ quotePartAttributeForm.attribute_name.value }}</td>
                                                <td>
                                                    {{ quotePartAttributeForm.attribute_value }}{{ quotePartAttributeForm.attribute_value.errors }}
                                            </tr>
                                        {% endfor %}
                                    </table>
                                    {% for hidden in form.hidden_fields %}
                                        {{ hidden }}
                                    {% endfor %}
                                </td>
                            {% endif %}
                        {% endfor %}
                        {% for field in form.visible_fields %}
                            <td>
                                {{ field }}{{ field.errors }}
                            </td>
                        {% endfor %}
                    </tr>
                {% endfor %}
            </table>
        </fieldset>

        {% include "epic/form_standard_actions.html" %}
    </form>
    {% include "epic/notes_display.html" %}

{% endblock %}
