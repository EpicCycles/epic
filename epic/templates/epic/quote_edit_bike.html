{% extends 'epic/base.html' %}
{% load staticfiles %}
{% load static %}
{% load popup_helper %}
{% block content %}
    <h2>Quote - {{ quote.customer }} / {{ quote.frame }}</h2>
    <form action="{% url 'quote_edit_bike' pk=quote.pk %}" method="post">
        {% csrf_token %}
        <table>
            <tr>
                <td class="align_top">
                    {{ quote_form.non_field_errors }}
                    <table>
                        {% for field in quote_form.visible_fields %}
                            <tr>
                                <th>{{ field.label_tag }}</th>
                                {% include "epic/field_as_td.html"  with field=field %}
                            </tr>
                        {% endfor %}
                        <tr>
                            <th>Quote Total (Â£)</th>
                            <td>{{ quote.sell_price }}</td>
                            <td></td>
                        </tr>
                    </table>
                    {% for hidden in quote_form.hidden_fields %}
                        {{ hidden }}
                    {% endfor %}
                </td>
                <td class="align_top">
                    <h4>Add Item to Quote</h4>
                    {% include "epic/form_as_table.html"  with form=quoteSimpleAddPart %}
                </td>
                <td class="align_top">
                    <h4>Fitting Details</h4>
                    {% if customerFittings %}
                        <select name='id_fitting' id='id_fitting' title="select existing fitting to use">
                            <option value="">No Fitting</option>
                            {% for fitting in customerFittings %}
                                <option value="{{ fitting.id }}" {% if quote.fitting == fitting %}
                                        selected {% endif %}>{{ fitting }}</option>
                            {% endfor %}
                        </select>
                    {% else %}
                        <strong>Self Sized</strong>
                    {% endif %}
                    <h4>New Fitting</h4>
                    {% include "epic/form_as_table.html" with form=fittingForm %}
                </td>
                <td class="align_top">
                    {% include "epic/add_notes.html" %}
                </td>
            </tr>
        </table>
        {% include "epic/form_standard_actions.html" %}
        <a href="{% url 'quote_issue' pk=quote.pk %}"  {% if quote.can_be_issued %} class="button"{% else %}
           class="button disabled" onclick="return false;" {% endif %}>Issue Quote</a>
        {% include "epic/quote_copy_options.html" %}

        <h3>Bike specification</h3>
        <table>
            <tr id="bike_header">
                <th class="listHead">Part Type</th>
                <th class="listHead">Bike Part</th>
                <th class="listHead">Additional Details</th>
                <th class="listHead">Not Reqd</th>
                <th class="listHead">Trade In</th>
                <th class="listHead">Quote Brand</th>
                <th class="listHead">Quote Part</th>
                <th class="listHead">Quantity</th>
                <th class="listHead">Sell Price</th>
            </tr>
        </table>
        <div style="height: 50%;overflow: scroll;">
            <table>
                {% for section, sectionContents in quoteSections %}
                    <tr>
                        <td colspan='9' class="section_part">{{ section.name }}</td>
                    </tr>
                    {% for quotePartDetails, form in sectionContents %}
                        {% cycle 'row1' 'row2' as rowcolors silent %}
                        <tr class="{{ rowcolors }}"
                                {% if forloop.first %}
                            id="bike_row"
                                {% endif %}>
                            {% for quote_part_data in quotePartDetails %}
                                {% if forloop.counter == 1 %}
                                    <td>{{ quote_part_data.partType }}</td>
                                    <td>
                                        {{ quote_part_data.frame_part.part }}
                                    </td>
                                {% endif %}
                                {% if forloop.counter == 2 %}
                                    <td>
                                        <table>
                                            {% for quotePartAttributeForm in quote_part_data %}
                                                <tr class="{{ rowcolors }}">
                                                    <td>
                                                        {{ quotePartAttributeForm.attribute_name.value }}
                                                        {% for hidden in quotePartAttributeForm.hidden_fields %}
                                                            {{ hidden }}
                                                        {% endfor %}
                                                    </td>
                                                    {% include "epic/field_as_td.html"  with field=quotePartAttributeForm.attribute_value %}
                                                </tr>
                                            {% endfor %}
                                        </table>
                                        {% for hidden in form.hidden_fields %}
                                            {{ hidden }}
                                        {% endfor %}
                                    </td>
                                {% endif %}
                            {% endfor %}
                            {% for field in form.visible_fields %}
                                {% include "epic/field_as_td.html"  with field=field %}
                            {% endfor %}
                        </tr>
                    {% endfor %}
                {% endfor %}
            </table>
        </div>

        {% include "epic/form_standard_actions.html" %}
        <a href="{% url 'quote_issue' pk=quote.pk %}"  {% if quote.can_be_issued %} class="button" {% else %}
           class="button disabled" onclick="return false;" {% endif %}>Complete Quote</a>

    </form>
    {% include "epic/notes_display.html" %}
    {% include "epic/quote_copy_new_bike.html" %}
    <script src="{% static 'js/quote_edit_bike.js' %}"></script>
    <script src="{% static 'js/quote_copy_action.js' %}"></script>

{% endblock %}
